---
title: "3T7T_Lymphnode_Statistics"
author: "Jack van Asten"
date: "April 7, 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document.

## Read data from csv and calculate volumes
```{r, echo=FALSE}
   library(readr)
   #Pat0_lymphnodes <- read_csv("~/BIOMR_CACHE/Pat0_lymphnodes.csv")
   Pat0LNs <- file.choose()
   LNs <- read_csv(Pat0LNs)
   # 4/3*PI*a*b*c*1/8 (radius; abc are diameters)
   Pt0_Volumes <- 1/6*pi*Pat0_lymphnodes[1]*Pat0_lymphnodes[2]*Pat0_lymphnodes[3]
```

```{r}
   summary(Pat0_lymphnodes)
   summary(Pt0_Volumes)
```

## Including Plots
Boxplots of the lymphnode sizes:
```{r pressure, echo=FALSE}
   library(ggplot2)
   boxplot(Pt0_Volumes,col="light blue")
   boxplot(Pat0_lymphnodes,col="light blue")
   #plot(pressure)
```

## Including Histogram
Histogram of the lymphnode sizes:
```{r, echo=FALSE}
   library(ggplot2)
   # for histogram or (bar)plot, make row out of column first
   LNsize <- data.frame(t(Pt0_Volumes))
   #?tibble::rownames_to_column(LNsize, var="LN_sizes")
   x <- (1:length(LNsize))

   hist(as.numeric(LNsize),breaks=15,xlab="lymph node size in mm^3",ylab="frequency",main="Scored nodes Pat0",col="light green")

   plot(x,LNsize,type="l",col="blue")
   #ggplot(LNsize,aes(x = "size mm^3",y=t.LNsize.)) + stat_identity(geom = "bar")
   ggplot(LNsize,aes(LNsize))
```

# Load total number of 3T lymphe nodes with labels
```{r, echo=false}
library(ggplot2)   #extended plot graphics
library(tidyverse) #extended data formatting
library(ggthemes)  #more gg themes
library(RColorBrewer)     #ggplot colours
(.packages())      #display loaded packages

#List colour palettes
display.brewer.all(colorblindFriendly=TRUE)

# Read confusion matrix from txt file
CSV_FILE <- choose.files(default = "*.csv",
            caption = "Select just one csv file",
            multi = FALSE)
#filters = Filters[c("csv", "txt"),]) don't work (JvA)

labeled_LNs <- read.csv2(CSV_FILE, 
                header = TRUE,  
                sep = ";",
                dec = ",")
                #fill = TRUE, 
                #strip.white = TRUE, 
                #stringsAsFactors=TRUE)

labeled_LNs <- labeled_LNs[1:(nrow(labeled_LNs)-6),]

print(labeled_LNs)

head(labeled_LNs)
relabel <- reshape2::melt(labeled_LNs) #?
head(relabel)

bp <- ggplot(labeled_LNs, aes(x=READER,y=VOLUME)) +
   geom_boxplot(colour="#3366FF",outlier.colour="red") +
   labs(x="Readers", y="LN volume in mm^3",title="      Scored Lymphe node volumes") +
   geom_jitter(size=1,alpha=0.2,width=0.2) +
   scale_y_continuous(limits=c(0, 50)) +
   #scale_color_jco() +
   #scale_fill_jco() +
   scale_color_brewer(palette="Paired") +
   scale_fill_brewer(palette="Paired") +
   theme_gdocs()
   #theme_stata()
   #theme_hc() #high charts
   #ylim(c(1, 150))
bp

hg <- ggplot(labeled_LNs, aes(y=VOLUME)) +
   geom_histogram(binwidth=0.5) +
   #facet_grid(.~variable) +
   scale_y_continuous(limits=c(0, 75)) +
   #scale_color_jco() +
   #scale_fill_jco() +
   scale_color_brewer(palette="Paired") +
   scale_fill_brewer(palette="Paired") +
   coord_flip() +
   theme_gdocs()
hg

pr <- ggplot(labeled_LNs, aes(x=READER,y=VOLUME)) +
   geom_pointrange(color= "blue", ymin=0, ymax=120) +
   labs(x = "Readers", y = "LN volume in mm^3") +
   ggtitle("Scored Lymphe node volumes") +
   geom_errorbar(ymin=0, ymax=50) +
   scale_y_continuous(limits=c(0, 50)) +
   #scale_color_jco() +
   #scale_fill_jco() +
   scale_color_brewer(palette="Paired") +
   scale_fill_brewer(palette="Paired") +
   theme_gdocs()
pr

relabel <- reshape2::melt(labeled_LNs) #?

fg <- ggplot(relabel, aes(y=READER,x=PATIENT,color=factor(READER))) +
   geom_point(shape=1,color="blue") +
   geom_smooth(method='gam', se=F) +
   facet_grid(.~variable) +
   coord_flip() +
   #scale_y_continuous(limits=c(0, 50)) +
   #scale_color_jco() +
   #scale_fill_jco() +
   scale_color_brewer(palette="Paired") +
   scale_fill_brewer(palette="Paired") +
   theme_gdocs()
fg

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

See: https://www.datanovia.com/en/lessons/cohens-kappa-in-r-for-two-categorical-variables/#kappa-for-two-categorical-variables-with-multiple-levels for an extended description of calculating kappa for 2 readers with multiple levels.


